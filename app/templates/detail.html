{% extends "base.html" %}
{% block content %}
{% if memo.visibility == 'secret' and not authorized %}
<form method="post">
    <div class="mb-3">
        <label for="password" class="form-label">パスワード</label>
        <input type="password" class="form-control" id="password" name="password">
    </div>
    <button type="submit" class="btn btn-primary">表示</button>
</form>

<!-- ▼ 削除ボタン（秘密メモの未認証画面にも表示してOK：所有者のみがここに来れるため） -->
<form method="post" action="{{ url_for('memo_delete', mid=memo.id) }}" class="mt-3"
      onsubmit="return confirm('このメモを削除します。よろしいですか？');">
  <button type="submit" class="btn btn-outline-danger">このメモを削除</button>
</form>

{% else %}
<div class="markdown-body">
  {{ memo_html|safe }}
</div>

{% if tags and tags|length > 0 %}
<div class="mt-3">
  <strong>タグ:</strong>
  {% for t in tags %}
    <a class="badge text-bg-secondary me-1" href="{{ url_for('search_by_tag') }}?name={{ t }}">#{{ t }}</a>
  {% endfor %}
</div>
{% endif %}

{% if related and related|length > 0 %}
<hr>
<h5>類似するメモ</h5>
<ul class="list-unstyled">
  {% for r in related %}
    <li class="mb-2">
      <a href="{{ url_for('memo_detail', mid=r.id) }}">
        {{ r.body[:50] }}{% if r.body|length > 50 %}…{% endif %}
      </a>
      <small class="text-muted d-block">{{ r.created_at }}</small>
    </li>
  {% endfor %}
</ul>
{% endif %}

<!-- ▼ 削除ボタン（本文表示時） -->
<hr>
<form method="post" action="{{ url_for('memo_delete', mid=memo.id) }}"
      onsubmit="return confirm('このメモを削除します。よろしいですか？');">
  <button type="submit" class="btn btn-outline-danger">このメモを削除</button>
</form>

{% endif %}
{% endblock %}
